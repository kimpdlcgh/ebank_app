<!DOCTYPE html>
<html>
<head>
    <title>Logo Extractor</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .section { border: 1px solid #ddd; margin: 20px 0; padding: 20px; border-radius: 8px; }
        .success { border-color: #22c55e; background-color: #f0fdf4; }
        .error { border-color: #ef4444; background-color: #fef2f2; }
        .warning { border-color: #f59e0b; background-color: #fffbeb; }
        button { padding: 10px 20px; margin: 5px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #2563eb; }
        .logo-preview { max-width: 200px; max-height: 100px; border: 1px solid #ddd; margin: 10px 0; }
        textarea { width: 100%; min-height: 200px; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <h1>üéØ Logo Extractor Tool</h1>
    
    <div class="section">
        <h3>Step 1: Get Your Current Logo</h3>
        <p>First, let's check what logo is currently stored in your SystemConfig:</p>
        <button onclick="fetchCurrentLogo()">Fetch Current Logo from Firebase</button>
        <div id="fetchResults"></div>
    </div>
    
    <div class="section">
        <h3>Step 2: Download Logo (if it's a URL)</h3>
        <p>If your logo is a Firebase Storage URL, we'll help you download it:</p>
        <button onclick="downloadLogo()">Download Logo as File</button>
        <div id="downloadResults"></div>
    </div>
    
    <div class="section">
        <h3>Step 3: Convert Base64 to File (if needed)</h3>
        <p>If your logo is base64, we'll convert it to a file you can save:</p>
        <button onclick="convertBase64()">Convert Base64 to Image File</button>
        <div id="base64Results"></div>
    </div>
    
    <div class="section">
        <h3>Step 4: Manual Logo Upload</h3>
        <p>Or upload your own logo file to convert it to the right format:</p>
        <input type="file" id="logoFile" accept="image/*" onchange="processUploadedFile()">
        <div id="uploadResults"></div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';

        // Your Firebase config - Updated to match your actual project
        const firebaseConfig = {
            apiKey: "AIzaSyCbAQrQEyETkBw_1nMlDwEnkn4jqt1uPpo",
            authDomain: "e-bank-dashboard.firebaseapp.com",
            projectId: "e-bank-dashboard",
            storageBucket: "e-bank-dashboard.firebasestorage.app",
            messagingSenderId: "186587489295",
            appId: "1:186587489295:web:c63b39b5216981bf89ef7a"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.currentLogoData = null;

        window.fetchCurrentLogo = async function() {
            const resultsDiv = document.getElementById('fetchResults');
            resultsDiv.innerHTML = '<p>üîÑ Fetching logo from Firebase...</p>';

            try {
                const configRef = doc(db, 'systemConfig', 'main');
                const configSnap = await getDoc(configRef);
                
                if (configSnap.exists()) {
                    const data = configSnap.data();
                    const logoUrl = data.branding?.logo?.primary;
                    
                    if (logoUrl) {
                        window.currentLogoData = logoUrl;
                        
                        if (logoUrl.startsWith('data:image/')) {
                            // Base64 image
                            resultsDiv.innerHTML = `
                                <div class="success">
                                    <h4>‚úÖ Found Base64 Logo!</h4>
                                    <p><strong>Type:</strong> Base64 encoded image</p>
                                    <p><strong>Size:</strong> ${(logoUrl.length * 0.75 / 1024).toFixed(2)} KB (estimated)</p>
                                    <img src="${logoUrl}" class="logo-preview" alt="Current logo">
                                    <p>This logo is already embedded. Use "Convert Base64 to Image File" to save it.</p>
                                </div>
                            `;
                        } else {
                            // URL image
                            resultsDiv.innerHTML = `
                                <div class="success">
                                    <h4>‚úÖ Found Logo URL!</h4>
                                    <p><strong>URL:</strong> ${logoUrl}</p>
                                    <img src="${logoUrl}" class="logo-preview" alt="Current logo" 
                                         onload="this.style.display='block'" 
                                         onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
                                    <p style="display:none; color:red;">‚ùå Could not load image from URL (CORS or access issue)</p>
                                    <p>Use "Download Logo as File" to save this image.</p>
                                </div>
                            `;
                        }
                    } else {
                        resultsDiv.innerHTML = `
                            <div class="error">
                                <h4>‚ùå No Logo Found</h4>
                                <p>Your SystemConfig doesn't have a logo set.</p>
                                <p>Use the manual upload option below to add a logo.</p>
                            </div>
                        `;
                    }
                } else {
                    resultsDiv.innerHTML = `
                        <div class="error">
                            <h4>‚ùå No SystemConfig Found</h4>
                            <p>Could not find systemConfig document in Firebase.</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="error">
                        <h4>‚ùå Error</h4>
                        <p>Failed to fetch logo: ${error.message}</p>
                    </div>
                `;
            }
        };

        window.downloadLogo = function() {
            const resultsDiv = document.getElementById('downloadResults');
            
            if (!window.currentLogoData) {
                resultsDiv.innerHTML = '<div class="error"><p>Please fetch the current logo first.</p></div>';
                return;
            }

            if (window.currentLogoData.startsWith('data:image/')) {
                resultsDiv.innerHTML = '<div class="warning"><p>Current logo is base64. Use "Convert Base64" instead.</p></div>';
                return;
            }

            // Create a temporary link to download the image
            const link = document.createElement('a');
            link.href = window.currentLogoData;
            link.download = 'company-logo.png';
            link.target = '_blank';
            
            resultsDiv.innerHTML = `
                <div class="success">
                    <h4>üì• Download Link Created</h4>
                    <p>Click the link below to download your logo:</p>
                    <a href="${window.currentLogoData}" download="company-logo.png" style="display: inline-block; padding: 10px 15px; background: #22c55e; color: white; text-decoration: none; border-radius: 4px;">
                        Download Logo
                    </a>
                    <p><small>Note: Due to CORS policies, the download might open in a new tab instead. Right-click the image and select "Save Image As..."</small></p>
                </div>
            `;
        };

        window.convertBase64 = function() {
            const resultsDiv = document.getElementById('base64Results');
            
            if (!window.currentLogoData) {
                resultsDiv.innerHTML = '<div class="error"><p>Please fetch the current logo first.</p></div>';
                return;
            }

            if (!window.currentLogoData.startsWith('data:image/')) {
                resultsDiv.innerHTML = '<div class="warning"><p>Current logo is not base64. Use "Download Logo" instead.</p></div>';
                return;
            }

            try {
                // Extract the base64 data
                const [header, base64Data] = window.currentLogoData.split(',');
                const mimeMatch = header.match(/data:(.+);base64/);
                const mimeType = mimeMatch ? mimeMatch[1] : 'image/png';
                
                // Convert to blob
                const byteCharacters = atob(base64Data);
                const byteNumbers = new Array(byteCharacters.length);
                for (let i = 0; i < byteCharacters.length; i++) {
                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                }
                const byteArray = new Uint8Array(byteNumbers);
                const blob = new Blob([byteArray], { type: mimeType });
                
                // Create download link
                const url = URL.createObjectURL(blob);
                const extension = mimeType.split('/')[1] || 'png';
                
                resultsDiv.innerHTML = `
                    <div class="success">
                        <h4>‚úÖ Base64 Converted Successfully!</h4>
                        <p><strong>Type:</strong> ${mimeType}</p>
                        <p><strong>Size:</strong> ${(blob.size / 1024).toFixed(2)} KB</p>
                        <img src="${window.currentLogoData}" class="logo-preview" alt="Logo preview">
                        <br>
                        <a href="${url}" download="company-logo.${extension}" style="display: inline-block; padding: 10px 15px; background: #22c55e; color: white; text-decoration: none; border-radius: 4px; margin-top: 10px;">
                            üíæ Download as ${extension.toUpperCase()} File
                        </a>
                        <p><strong>Instructions:</strong></p>
                        <ol>
                            <li>Click the download button above</li>
                            <li>Save the file as "logo.${extension}" in your Downloads</li>
                            <li>Copy the file to your project's public folder</li>
                        </ol>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="error">
                        <h4>‚ùå Conversion Failed</h4>
                        <p>Error: ${error.message}</p>
                    </div>
                `;
            }
        };

        window.processUploadedFile = function() {
            const fileInput = document.getElementById('logoFile');
            const resultsDiv = document.getElementById('uploadResults');
            
            if (!fileInput.files[0]) {
                resultsDiv.innerHTML = '';
                return;
            }

            const file = fileInput.files[0];
            
            // Validate file
            if (!file.type.startsWith('image/')) {
                resultsDiv.innerHTML = '<div class="error"><p>Please select an image file.</p></div>';
                return;
            }

            if (file.size > 5 * 1024 * 1024) { // 5MB limit
                resultsDiv.innerHTML = '<div class="error"><p>File too large. Please select an image under 5MB.</p></div>';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // Resize if needed (max 400x200 for optimal performance)
                    const maxWidth = 400;
                    const maxHeight = 200;
                    let { width, height } = img;
                    
                    if (width > maxWidth || height > maxHeight) {
                        const ratio = Math.min(maxWidth / width, maxHeight / height);
                        width *= ratio;
                        height *= ratio;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Convert to optimized formats
                    const pngUrl = canvas.toDataURL('image/png', 0.8);
                    const jpegUrl = canvas.toDataURL('image/jpeg', 0.8);
                    
                    resultsDiv.innerHTML = `
                        <div class="success">
                            <h4>‚úÖ Logo Processed Successfully!</h4>
                            <p><strong>Original:</strong> ${file.name} (${(file.size/1024).toFixed(2)} KB)</p>
                            <p><strong>Optimized:</strong> ${width}x${height} pixels</p>
                            
                            <div style="margin: 20px 0;">
                                <img src="${pngUrl}" class="logo-preview" alt="Logo preview">
                            </div>
                            
                            <div style="display: flex; gap: 10px;">
                                <a href="${pngUrl}" download="logo.png" style="display: inline-block; padding: 10px 15px; background: #3b82f6; color: white; text-decoration: none; border-radius: 4px;">
                                    üíæ Download PNG
                                </a>
                                <a href="${jpegUrl}" download="logo.jpg" style="display: inline-block; padding: 10px 15px; background: #059669; color: white; text-decoration: none; border-radius: 4px;">
                                    üíæ Download JPEG
                                </a>
                            </div>
                            
                            <p><strong>Next Steps:</strong></p>
                            <ol>
                                <li>Download your preferred format (PNG recommended for logos)</li>
                                <li>Save as "logo.png" in your project's public folder</li>
                                <li>Update your code to use this static file</li>
                            </ol>
                        </div>
                    `;
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        };
    </script>
</body>
</html>